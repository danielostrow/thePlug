# CVE Database Integration

Guide for checking dependencies against CVE databases using native package manager tools.

## Package Manager Audit Commands

### Node.js (npm/yarn/pnpm)

```bash
# npm audit
npm audit --json 2>/dev/null | jq '.vulnerabilities | to_entries[] | {
  package: .key,
  severity: .value.severity,
  via: .value.via[0].title,
  fixAvailable: .value.fixAvailable
}'

# yarn audit
yarn audit --json 2>/dev/null | jq 'select(.type == "auditAdvisory") | .data.advisory | {
  package: .module_name,
  severity: .severity,
  title: .title,
  patched_versions: .patched_versions
}'

# pnpm audit
pnpm audit --json 2>/dev/null
```

### Python (pip)

```bash
# pip-audit (recommended)
pip-audit --format json 2>/dev/null | jq '.[] | {
  package: .name,
  version: .version,
  vulns: .vulns[] | {id: .id, fix_versions: .fix_versions}
}'

# safety (alternative)
safety check --json 2>/dev/null | jq '.[] | {
  package: .[0],
  affected: .[1],
  installed: .[2],
  vulnerability: .[3],
  id: .[4]
}'

# pip check for dependency issues
pip check
```

### Go

```bash
# govulncheck (official Go vulnerability scanner)
govulncheck -json ./... 2>/dev/null | jq '.[] | select(.Vuln != null) | {
  id: .Vuln.ID,
  package: .Vuln.ModPath,
  symbol: .Vuln.Symbol,
  fixed: .Vuln.FixedVersion
}'

# nancy (alternative)
nancy sleuth --quiet < <(go list -json -deps ./... 2>/dev/null)
```

### Rust

```bash
# cargo-audit
cargo audit --json 2>/dev/null | jq '.vulnerabilities.list[] | {
  id: .advisory.id,
  package: .package.name,
  severity: .advisory.severity,
  title: .advisory.title,
  patched: .versions.patched
}'
```

### Ruby

```bash
# bundler-audit
bundle audit check --format json 2>/dev/null | jq '.results[] | {
  gem: .gem.name,
  version: .gem.version,
  advisory: .advisory.id,
  title: .advisory.title,
  patched: .advisory.patched_versions
}'
```

### PHP

```bash
# composer audit
composer audit --format json 2>/dev/null | jq '.advisories | to_entries[] | {
  package: .key,
  advisories: .value[] | {id: .advisoryId, title: .title, severity: .severity}
}'

# local-php-security-checker (alternative)
local-php-security-checker --format json
```

## CVSS Severity Mapping

| CVSS Score | Severity | Priority |
|------------|----------|----------|
| 9.0 - 10.0 | Critical | Immediate |
| 7.0 - 8.9  | High     | 24 hours |
| 4.0 - 6.9  | Medium   | 1 week |
| 0.1 - 3.9  | Low      | Next release |

## CVE Database Sources

### Primary Sources
- **NVD (National Vulnerability Database)**: https://nvd.nist.gov/
- **GitHub Advisory Database**: https://github.com/advisories
- **Snyk Vulnerability DB**: https://snyk.io/vuln/

### Language-Specific
- **npm**: https://www.npmjs.com/advisories
- **PyPI**: https://pypi.org/security/
- **RubyGems**: https://rubygems.org/gems/bundler-audit
- **crates.io**: https://rustsec.org/

## Automated Scanning Script

```bash
#!/bin/bash
# detect-cves.sh - Multi-ecosystem CVE scanner

echo "=== CVE Scan Results ==="

# Node.js
if [ -f "package.json" ]; then
  echo -e "\n## Node.js Dependencies"
  npm audit --json 2>/dev/null | jq -r '.metadata | "Vulnerabilities: \(.vulnerabilities | add)"' || echo "No npm audit available"
fi

# Python
if [ -f "requirements.txt" ] || [ -f "pyproject.toml" ]; then
  echo -e "\n## Python Dependencies"
  pip-audit 2>/dev/null || echo "Install pip-audit: pip install pip-audit"
fi

# Go
if [ -f "go.mod" ]; then
  echo -e "\n## Go Dependencies"
  govulncheck ./... 2>/dev/null || echo "Install govulncheck: go install golang.org/x/vuln/cmd/govulncheck@latest"
fi

# Rust
if [ -f "Cargo.toml" ]; then
  echo -e "\n## Rust Dependencies"
  cargo audit 2>/dev/null || echo "Install cargo-audit: cargo install cargo-audit"
fi

echo -e "\n=== Scan Complete ==="
```

## Integration with CI/CD

### GitHub Actions Example
```yaml
- name: Security Audit
  run: |
    npm audit --audit-level=high
    # Fails if high or critical vulnerabilities found
```

### Exit Codes
- `0`: No vulnerabilities found
- `1`: Vulnerabilities found (check severity)
- `2`: Audit tool error
