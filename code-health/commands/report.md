---
name: report
description: Generate a detailed health report in markdown, HTML, or JSON format
argument-hint: "[--format markdown|html|json] [--output <path>]"
allowed-tools: ["Read", "Write", "Grep", "Glob", "Bash"]
---

# Generate Report Command

Create a comprehensive health report for documentation, sharing, or CI/CD integration.

## Arguments

- `--format <type>`: Output format
  - **markdown**: Formatted markdown (default)
  - **html**: HTML report with styling
  - **json**: Machine-readable JSON
- `--output <path>`: Save to file (displays if not specified)
- `--include <sections>`: Comma-separated sections to include
  - **summary**: Executive summary only
  - **security**: Security findings
  - **debt**: Technical debt analysis
  - **deps**: Dependency audit
  - **all**: All sections (default)
- `--path <directory>`: Target directory to analyze (default: current)

## Workflow

### Step 1: Run Full Analysis

Execute comprehensive scans:
1. Security scan (secrets, OWASP, CVEs)
2. Technical debt analysis (complexity, TODOs, smells)
3. Dependency audit (outdated, licenses, unused)

### Step 2: Calculate Scores

```
Security Score = 100 - (critical*15 + high*10 + medium*3 + low*1)
Debt Score = 100 - (god_files*5 + ancient_todos*1 + circular_deps*8)
Deps Score = 100 - (cve_critical*10 + major_outdated*3 + unused*2)

Overall = (Security * 0.4) + (Debt * 0.3) + (Deps * 0.3)
```

### Step 3: Generate Report

## Markdown Output Format

```markdown
# Code Health Report

**Project**: [project-name]
**Date**: [YYYY-MM-DD HH:MM]
**Analyzed**: [X] files, [Y] lines of code

---

## Executive Summary

| Category | Score | Grade | Issues |
|----------|-------|-------|--------|
| **Overall** | [X] | [A-F] | [total] |
| Security | [X] | [A-F] | [count] |
| Technical Debt | [X] | [A-F] | [count] |
| Dependencies | [X] | [A-F] | [count] |

### Key Findings

| Severity | Count | Top Issue |
|----------|-------|-----------|
| Critical | [X] | [description] |
| High | [X] | [description] |
| Medium | [X] | [description] |
| Low | [X] | [description] |

---

## Security Analysis

### Secrets Detected: [count]

| Location | Type | Risk |
|----------|------|------|
| file:line | [type] | [severity] |

### Vulnerability Patterns: [count]

1. **[SEVERITY]** [Type] - `file:line`
   - Pattern: [description]
   - Fix: [recommendation]

### Dependency CVEs: [count]

| Package | CVE | CVSS | Severity | Fix |
|---------|-----|------|----------|-----|
| [name] | [id] | [score] | [level] | [version] |

---

## Technical Debt Analysis

### Debt Score: [X]/100

### Complexity Hotspots

| File | Lines | Functions | Max Depth | Status |
|------|-------|-----------|-----------|--------|
| [path] | [N] | [N] | [N] | [status] |

### TODO Archaeology

- **Total**: [X] comments
- **Ancient** (>90 days): [Y]
- **Stale** (30-90 days): [Z]
- **Fresh** (<30 days): [W]

#### Oldest Items

| Location | Comment | Age | Author |
|----------|---------|-----|--------|
| file:line | [text] | [age] | [author] |

### Code Smells: [count]

1. **[Type]**: `[file]`
   - Issue: [description]
   - Recommendation: [fix]

---

## Dependency Health

### Package Summary

- **Total**: [X] dependencies
- **Outdated**: [Y] packages
- **CVEs**: [Z] vulnerabilities
- **Unused**: [W] packages

### Outdated Packages

| Package | Current | Latest | Gap |
|---------|---------|--------|-----|
| [name] | [ver] | [ver] | [type] |

### License Summary

| License | Count | Status |
|---------|-------|--------|
| MIT | [N] | OK |
| GPL-3.0 | [N] | Review |

---

## Recommendations

### Immediate (Critical/High)

1. [Action item with specific file/fix]
2. [Action item]

### Short-term (Medium)

1. [Action item]
2. [Action item]

### Long-term (Low)

1. [Action item]
2. [Action item]

---

## Quick Fixes

Run these commands to address auto-fixable issues:

\`\`\`bash
# Security fixes
/code-health:fix --security

# Remove dead code
/code-health:fix --debt

# Update dependencies
/code-health:fix --deps
\`\`\`

---

*Generated by Code Health Plugin*
```

## JSON Output Format

```json
{
  "project": "project-name",
  "timestamp": "2024-01-15T14:32:00Z",
  "stats": {
    "files": 156,
    "lines": 24567
  },
  "scores": {
    "overall": 83,
    "security": 91,
    "debt": 74,
    "dependencies": 84,
    "grade": "B"
  },
  "security": {
    "secrets": [...],
    "vulnerabilities": [...],
    "cves": [...]
  },
  "debt": {
    "complexity": [...],
    "todos": [...],
    "smells": [...],
    "deadCode": [...]
  },
  "dependencies": {
    "outdated": [...],
    "cves": [...],
    "licenses": [...],
    "unused": [...]
  },
  "recommendations": {
    "critical": [...],
    "high": [...],
    "medium": [...],
    "low": [...]
  }
}
```

## Example Usage

```
/code-health:report
/code-health:report --format json --output ./reports/health.json
/code-health:report --format markdown --output ./HEALTH_REPORT.md
/code-health:report --include security,deps
```
